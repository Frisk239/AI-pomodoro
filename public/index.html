<!DOCTYPE html>
<html lang="zh-CN">
<head>

    <!-- 页面元数据设置 -->
    <meta charset="UTF-8">  <!-- 设置字符编码为UTF-8，支持中文显示 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  <!-- 响应式视口设置，确保在移动设备上正确显示 -->
    <title>CAI</title>  <!-- 页面标题 -->
    <link rel="stylesheet" href="style.css">  <!-- 引入外部CSS样式表 -->
    <!-- 引入Socket.IO客户端库，用于实现实时通信功能 -->
    <script src="/socket.io/socket.io.js"></script>
    <!-- 引入Chart.js库，用于数据可视化 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">  <!-- 主容器，包含整个页面的内容 -->
        <header>  <!-- 页面头部 -->
            <div class="header-content">
                <h1>🍅 智能番茄钟学习辅助系统</h1>  <!-- 系统标题 -->
                <p class="header-subtitle">让学习更高效，让专注更有趣</p>
            </div>
            <nav class="main-nav">  <!-- 主导航栏 -->
                <!-- 导航按钮组，用于切换不同的功能页面 -->
                <button class="nav-btn active" data-page="pomodoro">
                    <span class="nav-icon">🍅</span>
                    <span class="nav-text">番茄钟</span>
                </button>
                <button class="nav-btn" data-page="ai">
                    <span class="nav-icon">🤖</span>
                    <span class="nav-text">AI学习伙伴</span>
                </button>
                <button class="nav-btn" data-page="studyroom">
                    <span class="nav-icon">👥</span>
                    <span class="nav-text">虚拟自习室</span>
                </button>
                <button class="nav-btn" data-page="todo">
                    <span class="nav-icon">📋</span>
                    <span class="nav-text">待办事项</span>
                </button>
                <button class="nav-btn" data-page="stats">
                    <span class="nav-icon">📊</span>
                    <span class="nav-text">数据统计</span>
                </button>
                <button class="nav-btn" data-page="profile">
                    <span class="nav-icon">👤</span>
                    <span class="nav-text">个人中心</span>
                </button>
            </nav>
        </header>

        <main>  <!-- 页面主体内容 -->
            <!-- 番茄钟页面 -->
            <div id="pomodoro-page" class="page active">  <!-- 番茄钟功能页面，默认激活 -->
                <div class="timer-container">  <!-- 计时器容器 -->
                    <div class="timer-circle">  <!-- 圆形计时器显示区域 -->
                        <!-- SVG环形进度条 -->
                        <svg class="progress-ring" width="300" height="300">
                            <circle class="progress-ring-circle" stroke-width="8" fill="transparent" r="140" cx="150" cy="150"/>
                        </svg>
                        <div class="timer-display">  <!-- 计时器显示区域 -->
                            <div id="time-display">25:00</div>  <!-- 时间显示 -->
                            <div id="session-type">工作时段</div>  <!-- 会话类型显示 -->
                        </div>
                    </div>
                    
                    <div class="task-input">  <!-- 任务输入区域 -->
                        <input type="text" id="task-input" placeholder="请输入当前任务..." maxlength="50">  <!-- 任务输入框 -->
                        <span id="task-length">0/50</span>  <!-- 字符计数器 -->
                    </div>
        
                    <div class="controls">  <!-- 控制按钮区域 -->
                        <button id="start-btn" class="btn btn-primary">开始</button>  <!-- 开始按钮 -->
                        <button id="pause-btn" class="btn btn-secondary" disabled>暂停</button>  <!-- 暂停按钮 -->
                        <button id="reset-btn" class="btn btn-secondary">重置</button>  <!-- 重置按钮 -->
                        <button id="skip-btn" class="btn btn-outline">跳过</button>  <!-- 跳过按钮 -->
                    </div>
                </div>
        
                <div class="todays-stats">  <!-- 今日统计区域 -->
                    <div class="stat-badge">  <!-- 统计徽章 -->
                        <span class="stat-label">今日完成</span>  <!-- 统计标签 -->
                        <span class="stat-value" id="today-sessions-count">0</span>  <!-- 统计数值 -->
                        <span class="stat-unit">个番茄</span>  <!-- 统计单位 -->
                    </div>
                    <div class="stat-badge">  <!-- 统计徽章 -->
                        <span class="stat-label">累计专注</span>  <!-- 统计标签 -->
                        <span class="stat-value" id="total-sessions-count">0</span>  <!-- 统计数值 -->
                        <span class="stat-unit">分钟</span>  <!-- 统计单位 -->
                    </div>
                </div>
            </div>
        
            <!-- AI学习伙伴页面 -->
            <div id="ai-page" class="page">  <!-- AI学习伙伴功能页面 -->
                <div class="ai-chat-container">  <!-- AI聊天容器 -->
                    <div class="ai-chat-header">
                        <div class="ai-avatar">
                            <span class="ai-avatar-icon">🤖</span>
                        </div>
                        <div class="ai-info">
                            <h2>AI学习伙伴</h2>
                            <p>在线为您提供学习建议和帮助</p>
                        </div>
                    </div>

                    <div class="ai-chat-messages" id="ai-chat-messages">  <!-- 聊天消息区域 -->
                        <!-- 系统欢迎消息 -->
                        <div class="message-wrapper system-message">
                            <div class="message-bubble system-bubble">
                                <div class="message-content">你好！我是你的AI学习伙伴，可以帮你制定学习计划、解答问题或提供学习建议。</div>
                                <div class="message-time">系统消息</div>
                            </div>
                        </div>
                    </div>

                    <div class="ai-chat-input-area">  <!-- AI输入区域 -->
                        <div class="ai-quick-actions">
                            <button class="quick-action-btn" data-prompt="帮我制定今天的学习计划">
                                <span class="action-icon">📝</span>
                                <span class="action-text">学习计划</span>
                            </button>
                            <button class="quick-action-btn" data-prompt="解释番茄工作法的原理">
                                <span class="action-icon">🍅</span>
                                <span class="action-text">方法解释</span>
                            </button>
                            <button class="quick-action-btn" data-prompt="如何提高学习专注力？">
                                <span class="action-icon">💡</span>
                                <span class="action-text">专注技巧</span>
                            </button>
                        </div>

                        <div class="ai-input-wrapper">
                            <input type="text" id="ai-message-input" placeholder="向AI学习伙伴提问..." maxlength="200">
                            <button id="ai-send-btn" class="btn btn-primary send-btn">
                                <span class="send-icon">📤</span>
                                <span class="send-text">发送</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        
            <!-- 虚拟自习室页面 -->
            <div id="studyroom-page" class="page">
                <div class="studyroom-full-container">
                    <h2>👥 虚拟自习室</h2>
                    <div class="room-controls-full">
                        <input type="text" id="username-input" placeholder="请输入你的昵称" maxlength="20">
                        <input type="text" id="room-id-input" placeholder="输入房间ID" maxlength="20">
                        <button id="join-room-btn" class="btn btn-primary">加入房间</button>
                        <button id="create-room-btn" class="btn btn-outline">创建房间</button>
                    </div>
                
                    <div class="room-content-full" style="display: none;" id="room-content">
                        <div class="room-layout-full">
                            <div class="room-users-section">
                                <h4>在线用户</h4>
                                <div id="room-users-list" class="room-users-list">
                                    <!-- 用户列表将通过JavaScript动态加载 -->
                                </div>
                            </div>
                        
                            <div class="room-chat-section">
                                <div id="room-chat-messages" class="room-chat-messages">
                                    <!-- 聊天消息将通过JavaScript动态加载 -->
                                </div>
                                <div class="room-chat-input">
                                    <input type="text" id="room-message-input" placeholder="输入聊天消息..." maxlength="200">
                                    <button id="room-send-btn" class="btn btn-primary">发送</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 待办事项页面 -->
            <div id="todo-page" class="page">
                <div class="todo-header">
                    <h2>📋 待办事项管理</h2>
                    <div class="todo-controls">
                        <input type="text" id="new-todo-input" placeholder="添加新的待办事项..." maxlength="100">
                        <input type="number" id="todo-duration" placeholder="分钟" min="1" max="240" value="25">
                        <button id="add-todo-btn" class="btn btn-primary">添加</button>
                    </div>
                </div>

                <div class="todo-lists">
                    <div class="todo-section">
                        <h3>🕒 待完成</h3>
                        <div id="pending-todos" class="todo-list">
                            <!-- 待办事项将通过JavaScript动态加载 -->
                        </div>
                    </div>

                    <div class="todo-section">
                        <h3>✅ 已完成</h3>
                        <div id="completed-todos" class="todo-list">
                            <!-- 已完成事项将通过JavaScript动态加载 -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- 数据统计页面 -->
            <div id="stats-page" class="page">
                <div class="stats-header">
                    <h2>📊 学习数据统计</h2>
                    <div class="stats-controls">
                        <div class="date-filter">
                            <select id="stats-period">
                                <option value="week">本周</option>
                                <option value="month">本月</option>
                                <option value="year">今年</option>
                            </select>
                        </div>
                        <button id="chart-analysis-btn" class="btn btn-primary">
                            📈 图表分析
                        </button>
                    </div>
                </div>
            
                <!-- 统计概览卡片 -->
                <div class="stats-overview">
                    <div class="overview-card primary">
                        <div class="overview-icon">🍅</div>
                        <div class="overview-content">
                            <h3>累计专注</h3>
                            <div class="overview-numbers">
                                <div class="number-group">
                                    <span class="number" id="total-sessions">0</span>
                                    <span class="label">总番茄钟</span>
                                </div>
                                <div class="number-group">
                                    <span class="number" id="total-minutes">0</span>
                                    <span class="label">总专注分钟</span>
                                </div>
                            </div>
                        </div>
                    </div>
            
                    <div class="overview-card success">
                        <div class="overview-icon">🎯</div>
                        <div class="overview-content">
                            <h3>当日专注</h3>
                            <div class="overview-numbers">
                                <div class="number-group">
                                    <span class="number" id="today-sessions">0</span>
                                    <span class="label">今日番茄钟</span>
                                </div>
                                <div class="number-group">
                                    <span class="number" id="today-minutes">0</span>
                                    <span class="label">今日分钟</span>
                                </div>
                            </div>
                        </div>
                    </div>
            
                    <div class="overview-card info">
                        <div class="overview-icon">📈</div>
                        <div class="overview-content">
                            <h3>平均专注</h3>
                            <div class="overview-numbers">
                                <div class="number-group">
                                    <span class="number" id="avg-sessions">0</span>
                                    <span class="label">日均番茄</span>
                                </div>
                                <div class="number-group">
                                    <span class="number" id="avg-minutes">0</span>
                                    <span class="label">日均分钟</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            
                <div class="stats-content">
                    <!-- 左侧：详细记录 -->
                    <div class="history-section">
                        <div class="section-header">
                            <h3>📝 详细记录</h3>
                            <span class="record-count" id="record-count">共 0 条记录</span>
                        </div>
                        <div id="history-list" class="history-list">
                            <!-- 记录将通过JavaScript动态加载 -->
                        </div>
                    </div>
            
                    <!-- 右侧：动态图片和快速统计 -->
                    <div class="visual-section">
                        <!-- 动态图片区域 -->
                        <div class="animation-container">
                            <div class="floating-tomato">🍅</div>
                            <div class="floating-book">📚</div>
                            <div class="floating-clock">⏰</div>
                            <div class="focus-animation">
                                <div class="pulse-circle"></div>
                                <div class="concentration-text">专注中...</div>
                            </div>
                        </div>
            
                        <!-- 快速统计 -->
                        <div class="quick-stats">
                            <h4>🎯 快速统计</h4>
                            <div class="quick-stat-item">
                                <span class="stat-name">最长专注</span>
                                <span class="stat-value" id="longest-session">0 分钟</span>
                            </div>
                            <div class="quick-stat-item">
                                <span class="stat-name">最佳时段</span>
                                <span class="stat-value" id="best-hour">未记录</span>
                            </div>
                            <div class="quick-stat-item">
                                <span class="stat-name">连续天数</span>
                                <span class="stat-value" id="streak-days">0 天</span>
                            </div>
                            <div class="quick-stat-item">
                                <span class="stat-name">完成率</span>
                                <span class="stat-value" id="completion-rate">0%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 图表分析页面 -->
            <div id="charts-page" class="page">
                <div class="charts-header">
                    <button id="back-to-stats" class="btn btn-outline">← 返回统计</button>
                    <h2>📈 详细图表分析 - <span id="chart-period">本周</span></h2>
                </div>
            
                <div class="charts-grid">
                    <div class="chart-card">
                        <h3>🍅 专注时长分布</h3>
                        <canvas id="duration-chart" width="400" height="300"></canvas>
                    </div>
            
                    <div class="chart-card">
                        <h3>📊 时间趋势分析</h3>
                        <canvas id="trend-chart" width="400" height="300"></canvas>
                    </div>
            
                    <div class="chart-card full-width">
                        <h3>⏰ 月度专注统计</h3>
                        <canvas id="monthly-chart" width="800" height="300"></canvas>
                    </div>
            
                    <div class="chart-card">
                        <h3>🌅 专注时段分布</h3>
                        <canvas id="hourly-chart" width="400" height="300"></canvas>
                    </div>
            
                    <div class="chart-card">
                        <h3>📈 年度专注趋势</h3>
                        <canvas id="yearly-chart" width="400" height="300"></canvas>
                    </div>
                </div>
            </div>

            <!-- 个人中心页面 -->
            <div id="profile-page" class="page">
                <div class="profile-container">
                    <div class="profile-header">
                        <h2>👤 个人中心</h2>
                        <p>管理您的账户信息和设置</p>
                    </div>

                    <!-- 用户信息卡片 -->
                    <div class="profile-card">
                        <h3>📋 账户信息</h3>
                        <div class="user-info">
                            <div class="info-item">
                                <label>用户名:</label>
                                <span id="user-username">加载中...</span>
                            </div>
                            <div class="info-item">
                                <label>邮箱:</label>
                                <span id="user-email">加载中...</span>
                            </div>
                            <div class="info-item">
                                <label>注册时间:</label>
                                <span id="user-created-at">加载中...</span>
                            </div>
                        </div>
                    </div>

                    <!-- 修改密码卡片 -->
                    <div class="profile-card">
                        <h3>🔒 修改密码</h3>
                        <form id="change-password-form" class="profile-form">
                            <div class="form-group">
                                <label for="old-password">当前密码</label>
                                <input type="password" id="old-password" required>
                                <div class="error-message" id="old-password-error"></div>
                            </div>

                            <div class="form-group">
                                <label for="new-password">新密码</label>
                                <input type="password" id="new-password" required minlength="6">
                                <div class="error-message" id="new-password-error"></div>
                                <small class="form-hint">密码至少需要6个字符</small>
                            </div>

                            <div class="form-group">
                                <label for="confirm-new-password">确认新密码</label>
                                <input type="password" id="confirm-new-password" required>
                                <div class="error-message" id="confirm-new-password-error"></div>
                            </div>

                            <button type="submit" class="btn btn-primary" id="change-password-btn">
                                修改密码
                            </button>
                        </form>
                    </div>

                    <!-- 账户操作卡片 -->
                    <div class="profile-card danger">
                        <h3>⚠️ 危险操作</h3>
                        <p class="warning-text">
                            以下操作不可逆，请谨慎使用！
                        </p>

                        <div class="action-buttons">
                            <button class="btn btn-secondary" id="logout-btn">
                                🚪 退出登录
                            </button>

                            <button class="btn btn-danger" id="delete-account-btn">
                                🗑️ 注销账号
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 注销账号确认模态框 -->
            <div id="delete-account-modal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>⚠️ 确认注销账号</h3>
                    </div>
                    <div class="modal-body">
                        <p class="danger-text">
                            <strong>警告：</strong>此操作不可逆！注销账号将永久删除以下所有数据：
                        </p>
                        <ul class="danger-list">
                            <li>您的账户信息</li>
                            <li>所有番茄钟学习记录</li>
                            <li>所有待办事项</li>
                            <li>学习统计数据</li>
                        </ul>
                        <p>请输入您的密码以确认注销：</p>
                        <input type="password" id="delete-confirm-password" placeholder="输入密码确认注销" required>
                        <div class="error-message" id="delete-password-error"></div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" id="cancel-delete-btn">取消</button>
                        <button class="btn btn-danger" id="confirm-delete-btn">确认注销</button>
                    </div>
                </div>
            </div>

            <!-- 退出登录确认模态框 -->
            <div id="logout-modal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>🚪 确认退出登录</h3>
                    </div>
                    <div class="modal-body">
                        <p>您确定要退出登录吗？</p>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" id="cancel-logout-btn">取消</button>
                        <button class="btn btn-primary" id="confirm-logout-btn">确认退出</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- 通知音 -->
    <audio id="notification-sound" preload="auto">
        <source src="https://assets.mixkit.co/active_storage/sfx/1356/1356.wav" type="audio/mpeg">
    </audio>

    <!-- 认证服务（必须在主脚本之前加载） -->
    <script src="auth.js"></script>
    <script src="script.js"></script>
</body>
</html>
